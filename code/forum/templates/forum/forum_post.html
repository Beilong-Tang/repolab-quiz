<!doctype html>
<html lang="en" class="h-100">
  <head>
    <meta charset="utf-8">
    {% comment %} <meta name="viewport" content="width=device-width+100, initial-scale=2.0"> {% endcomment %}
    <meta name="description" content="">
    <meta name="author" content="Beilong Tang">
    <meta name="generator" content="Hugo 0.98.0">
    <title>Home Page</title>


{% load static %}
{% load my_tags%}
{% load markdownify %}

<link rel = "stylesheet" type ="text/css" href = "{% static 'quiz/bootstrap/css/bootstrap.min.css' %}">
<script type= "text/javascript" src = "{% static 'quiz/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<link rel = "stylesheet" type ="text/css" href = "{% static 'simple_judge/cover.css' %}">
<link rel = "stylesheet" type ="text/css" href = "{% static 'forum/sidebars.css' %}">
<link rel="stylesheet" href= "{% static 'quiz/highlight/styles/default.min.css' %}">
<link rel="icon" type="image/x-icon" href="{% static 'quiz/CS201.svg' %}">
{% comment %} <script type= "text/javascript" src="{% static 'forum/sidebars.js' %}"></script> {% endcomment %}
<script type= "text/javascript"  src = "{% static 'quiz/function.js' %}"></script>
<script src="{% static 'quiz/highlight/highlight.min.js' %}"></script>
<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
<script>function go(){var x = "{% url 'simple_judge:signout' %}";confirmation(x);}</script>
<script>hljs.highlightAll();</script>


<script>
  var previous_reply_id = 0;

  // to a new post
  function another(id){
    var forum_post_url = "{% url 'forum:forum_post' 1 0 0 filt %}";
    var length = parseInt($("#siding").scrollTop());
    to_forum_post(id,forum_post_url,length);
  }

  // create a new post 
  function newpost(){
    var create_post_url = "{% url 'forum:create_post' filt %}";
    to_url(create_post_url);
  }


  // submit comment 
  function commentsubmit(){
    if (document.getElementById('commenttextarea').value==""){alert('Your comment cannot be empty');return}

    var x = document.getElementById('comment_form');
    var length = parseInt($("#maintext").scrollTop());
    var action = x.action;
    action = action.replace(':0',':'+length);
    x.action=action;
    x.submit();
  
  }

  // change the star status (front-end involved)
  function change(id){
    var x = document.getElementById('staring');
    var y = document.getElementById('ifstar');

    if (x.style.fill=='black'){
      x.style.fill='red';
      y.style.color='red';
      y.innerText="UNSTAR";
      return;
    }
    x.style.fill='black';
    y.style.color='black';
    y.innerText="STAR";
    return;
  }
  

  // After you click on 'comment button'. This will focus on the comment 
  function showcomment(){
    var x = document.getElementById('comment_input');
    if (x.style.display=='none'){
    x.style.display='inline';
    var length = parseInt($("#maintext").scrollTop());
    length+=100;
    $("#maintext").scrollTop(length);
    }
  }

  // Cancel your comment 
  function cancelcomment(){
    var x = document.getElementById('commenttextarea');
    if (x.value==""){
      document.getElementById('comment_input').style.display='none';
      return 
    }
    var y = confirm("Are you sure you want to cancel?")
    if (y==true){
      document.getElementById('comment_input').style.display='none';
      x.value="";
    }
  }


  // Cancel your comment 
  function cancelreply(id){
    var x = document.getElementById('input_text'+id);
    if (x.value==""){
      document.getElementById('reply_input'+id).style.display='none';
      return 
    }
    var y = confirm("Are you sure you want to cancel?")
    if (y==true){
      document.getElementById('reply_input'+id).style.display='none';
      x.value="";
    }
  }

  function reply(id){
    var x = document.getElementById('reply_input'+id);
    x.style.display='inline';
    
  }

  function replysubmit(id){
    if (document.getElementById('input_text'+id).value==""){alert('Your Reply cannot be empty');return}

    var x = document.getElementById('reply_form'+id);
    var length = parseInt($("#maintext").scrollTop());
    var action = x.action;
    action = action.replace(':0',':'+length);
    x.action=action;
    x.submit();
  
  }




</script>
<style>
  h1{font-size:30px;}
  h2{font-size:27px;}
  h3{font-size:24px;}
  h4{font-size:21px;}
  h5{font-size:18px;}
  h6{font-size:15px;}
  p {font-size:16px;}

  img{
    max-width:100%;
    /* //max-height:700px; */
  }

  .commentbutton{
    background-color: #85a9de;
}

.commentbutton:hover{
    background-color: white;
    border: 2px solid aquamarine
}

</style>
  
  </head>
  <body class="d-flex h-100 text-center text-black bg-white">
    
    <div class="container-fluid d-flex w-100 h-100  mx-auto flex-column">
      <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
        <a  class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
          <svg class="bi me-2" width="40" height="32"><use xlink:href="#bootstrap"/></svg>
          <button type="button" class="btn btn-primary btn-lg" style="margin-left:30px" onclick="newpost()">New Post</button>
          <span class="fs-4" style='margin-left:30px'>CS201 Forum</span>
        </a>
        

        <ul class="nav nav-pills">
        <li class="nav-item"><a href="{% url 'quiz:userface' %}" class="nav-link " aria-current="page">Home</a></li>
        <li class="nav-item"><a href="{% url 'quiz:assignment'  %}" class="nav-link">Quizzes</a></li>
        <li class="nav-item"><a href="{% url 'quiz:account'  %}" class="nav-link">Account</a></li>
        <li class="nav-item"><a href="{% url 'forum:forum' 'All' %}" class="nav-link active">Forum</a></li>
        <li class="nav-item"><a href="#" class="nav-link" onclick="go()">Log out</a></li>
        </ul>
      </header>

    <main class="d-flex flex-nowrap">
              <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-white" style="width: 325px;font-size:10px;margin-left:5px">
                
              <div class='row'>

                  <div class = 'col-md-12'>
                      <a class="nav-link dropdown-toggle " href="#" id="dropdown01" data-bs-toggle="dropdown" aria-expanded="false" style="background:rgb(66, 141, 195)">{{filt|title1}}</a>
                      <ul class="dropdown-menu" aria-labelledby="dropdown01">
                        <li><a class="dropdown-item" href="{%url 'forum:forum' 'All' %}">All</a></li>
                              <li><a class="dropdown-item" href="{%url 'forum:forum' 'Star' %}">Star</a></li>
                              <li><a class="dropdown-item" href="{%url 'forum:forum' 'Week1' %}">Week1</a></li>
                              <li><a class="dropdown-item" href="{%url 'forum:forum' 'Week2' %}">Week2</a></li>
                              <li><a class="dropdown-item" href="{%url 'forum:forum' 'Week3' %}">Week3</a></li>
                              <li><a class="dropdown-item" href="{%url 'forum:forum' 'Week4' %}">Week4</a></li>
                              <li><a class="dropdown-item" href="{%url 'forum:forum' 'Week5' %}">Week5</a></li>
                              <li><a class="dropdown-item" href="{%url 'forum:forum' 'Week6' %}">Week6</a></li>
                              <li><a class="dropdown-item" href="{%url 'forum:forum' 'Week7' %}">Week7</a></li>
                              <li><a class="dropdown-item" href="#">Something else here</a></li>
                      </ul>
                    </div>

                    {% if problem %}
                          <div class='col-md-12'>
                            <a class="nav-link dropdown-toggle " href="#" id="dropdown01" data-bs-toggle="dropdown" aria-expanded="false" style="background:rgb(50, 182, 129);margin-top:4px">{{filt|title2}}</a>
                            <ul class="dropdown-menu" aria-labelledby="dropdown01" style='max-height:400px;overflow-y:scroll;text-align:center'>
                              <li><a class="dropdown-item" href="{%url 'forum:forum' first %}">All</a></li>
                              {%for i in problem%}
                              <li><a class="dropdown-item" href="{%url 'forum:forum' i.question_id %}">Problem{{forloop.counter}}</a></li>
                              {%endfor%}
                            </ul>
                          </div>
                          {% endif %}

                  </div>

                <div class="list-group list-group-flush border-bottom scrollarea" id ='siding'style='overflow:auto;white-space:nowrap'>
                  {% for c in post %}
                  <button  class="list-group-item list-group-item-action py-3 lh-sm  " id="{{c.id}}" aria-current="true" onclick='another({{c.id}})'>
                    <div class="d-flex w-100 align-items-center justify-content-between">
                      <strong class="mb-1" style="overflow: hidden;text-overflow: ellipsis;word-break:keep-all;white-space:nowrap;display:block;">
                        {%if c.id in post_star%}
                        <strong style='color:red'>Star</strong>
                        {%endif%}
                        <strong style='color:green'>{{c.question_id|show_question}}</strong> {{c.title}}</strong>
                    </div>
                                      <div class='row'>

                                        <div class="col-md-6 " style="overflow: hidden;text-overflow: ellipsis;word-break:keep-all;white-space:nowrap;display:block;text-align:left">
                                          <a style='color:red' name='category'><strong>{{c.category|show_category}}</strong></a>
                                           <strong style='margin-left:10px' name='colorauthor'>{{c.author_name}}</strong> 
                                        </div>

                                          <div class ='col-md-4' style=''>
                                            <small class="text-muted" style=''>{{c.pub_date|date}}</small>
                                          </div>

                                            <div class='col-md-2 ' style='font-size:1px'>
                                              {% if c.id in post_seen%}
                                              <strong style='color:red;display:inline' id='status'>New</strong>
                                              {% else %}
                                                        {% if c.id in comment_seen %}
                                                        <strong style='color:orange;font-size:100%' id ='comment' >Update</strong>
                                                        {% endif %}
                                              {% endif %}
                                            </div>
                                   
                                      </div>
                    </button>
                  {%endfor%}
                  <script>
                     var x = document.getElementById('{{current.id}}');
                     x.className = "list-group-item list-group-item-action py-3 lh-sm list-group-item-primary";
                     var y = document.getElementById('siding');
                     var roll = {{roll}};
                     if (roll!=-1){
                     $("#siding").scrollTop(roll);}
                     else{
                      var roll = $('#'+x.id).offset().top-145;
                      next_url =  "{% url 'forum:forum_post' 1 '0' 0 filt %}" ; 
                      to_forum_post(x.id,next_url,roll)
                      
                     }
                     

                     // Color the catogory 
                     var z = document.getElementsByName('category');
                          for (var i =0;i<z.length;i++){
                            {z[i].style='color:#4169e1';} //blue
                          }
                  </script>
                </div>
              </div>
        {% comment %} </div> {% endcomment %}
        <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-purple scrollarea" style='margin:0 auto;width:70%;' id ='maintext'>
              <div>
                  <div style="text-align:left;margin-left:100px;margin-right:100px;">
                      <h1 style=''>{{current.title}}</h1>
                    </div>



                              <div>
                                    <div class='row' style='width:90%' >
                                            <div class='col-md-6' style='margin-top:10px;text-align:left'>
                                                              <div class='row'>
                                                                <div class='col-md-1'>
                                                                      <div style='margin-left:100px'>
                                                                      <svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" viewBox="0, 0, 100, 100" width="45px" class="letterAvatar2 li-la2-gxmikey" name="icon_svg"><circle cx="50" cy="50" r="49"  style="fill:#fc1111" stroke="#ffffff" stroke-width="1" class="la2-circle" id='icon' />
                                                                        <text x="50" y="71.5" font-family="Arial" font-size="60" font-weight="700" text-anchor="middle" fill="#ffffff" class="la2-text">{{current.author_name|cap}}</text></svg>
                                                                      </div>
                                                                  </div>

                                                                  <div class='col-md-11'>
                                                                    <p style='margin-left:100px;font-size:20px' name ='colorauthor'>{{current.author_name}}</p>
                                                                    <p style='margin-left:100px;margin-top:-20px'><small class="text-muted">{{current.pub_date}}</small></p>
                                                                </div>
                                                              </div>
                                            </div>

                                              <div class='col-md-6' style='text-align:right'>

                                                <form method='post' action='{% url 'forum:save_star' current.id 0 filt %}'>

                                                            {%csrf_token%}
                                                                  <button type='submit' style='background:white;width:80px;border:none;margin-top:20px;'>
                                                                    
                                                                        <div>
                                                                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" style='fill:black' class="bi bi-star-fill" viewBox="0 0 16 16" aria-hidden="true" onclick="change()" id="staring">
                                                                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                                                                          </svg>
                                                                            <div height='10px'>
                                                                            <p style='color:black;height:10px' id='ifstar'>STAR</p>
                                                                            </div>
                                                                        </div>
                                                                </button>
                                                          </form>
                                                </div>
                                    </div>
                              </div>
                      <script>
                        var y = {{post_star}};
                        var z = {{current.id}};
                        for (var i =0;i<y.length;i++){
                          if (z ==y[i]){
                              var m = document.getElementById('ifstar');
                              var x = document.getElementById('staring');
                              x.style.fill='red';
                              m.style.color='red';
                              m.innerText="UNSTAR";
                              break;
                          }
                        }
                        
                      </script>
              </div>

                    <div style="text-align:left;margin-left:100px;margin-right:100px;">
                      {{text|markdownify}}
                    </div>
                    <script>
                      var w = document.getElementsByTagName('img');
                        for (var i =0;i<w.length;i++){
                          var p = w[i].parentNode.innerHTML;
                          var source = w[i].src;
                          w[i].parentNode.innerHTML= "<a href='"+source+"' target='_blank'>"+p+"</a>"
                        }
                    </script>

                    <div id = 'comment_area' style='margin-right:100px'>
                      <div style='text-align:left;margin-left:100px;margin-top:100px;'>
                      {%if current.comment_set.all %}
                      <h1> {{ comment_length }}  Comments: </h1>
                      {%endif%}
                      </div>
                      {% for comment,r in comment_and_reply %}
                      <div>
                            <div class='row'>
                              <div class = 'col-md-6'>
                                        <div class='row' style='text-align:left'>
                                          <div class='col-md-1'>
                                                <div style='margin-left:100px'>
                                                <svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" viewBox="0, 0, 100, 100" width="45px" class="letterAvatar2 li-la2-gxmikey" name="icon_svg"><circle cx="50" cy="50" r="49"  style="fill:#fc1111" stroke="#ffffff" stroke-width="1" class="la2-circle" id='icon' />
                                                  <text x="50" y="71.5" font-family="Arial" font-size="60" font-weight="700" text-anchor="middle" fill="#ffffff" class="la2-text">{{comment.author_name|cap}}</text></svg>
                                                </div>
                                            </div>

                                            <div class='col-md-11'>
                                              <p style='margin-left:100px;font-size:20px' name ='colorauthor'>{{comment.author_name}}</p>
                                              <p style='margin-left:100px;margin-top:-20px'>
                                                <small class="text-muted">{{comment.pub_date}}</small>
                                                {% if comment.id in message_seen%}
                                                <strong style='color:red'>New</strong>
                                                {%endif%}
                                              </p>
                                          </div>
                                        </div>
                            </div>
                                  
                              
                                  <div class='' style="text-align:left;word-wrap: break-word; word-break: normal;margin-bottom:40px;margin-left:100px;width:90%;margin-right:100px;">
                                    {{comment.text|markdownify}}
                                    
                        
                                  </div>
                                  
                                  <div style='margin-top:-10px'>
                                            {% for reply in r %}

                                      <div class='' style='margin-top:-30px;text-align:left;margin-left:100px'>
                                        <div class='row' style='width:90%' >
                                          <div class='col-md-6' style='margin-top:10px;text-align:left'>
                                                            <div class='row'>
                                                              <div class='col-md-1'>
                                                                    <div style='margin-left:100px'>
                                                                    <svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" viewBox="0, 0, 100, 100" width="30px" class="letterAvatar2 li-la2-gxmikey" name="icon_svg"><circle cx="50" cy="50" r="49"  style="fill:#fc1111" stroke="#ffffff" stroke-width="1" class="la2-circle" id='icon' />
                                                                      <text x="50" y="71.5" font-family="Arial" font-size="60" font-weight="700" text-anchor="middle" fill="#ffffff" class="la2-text">{{reply.author_name|cap}}</text></svg>
                                                                    </div>
                                                                </div>

                                                                <div class='col-md-11'>
                                                                  <p style='margin-left:100px;font-size:15px' ><a name ='colorauthor'>{{reply.author_name}} </a>
                                                                    <small class="text-muted">{{reply.pub_date}}</small>
                                                                    {%if reply.id in message_seen %}
                                                                    <strong style='color:red'>New</strong>
                                                                    {%endif%}
                                                                  </p>
                                                              </div>
                                                            </div>
                                          </div>
                                        </div>
                                        <div class='' style="text-align:left;word-wrap: break-word; word-break: normal;margin-bottom:40px;margin-left:145px;width:90%;margin-right:100px;margin-top:-30px">
                                              <p>{{reply.text|markdownify}}</p>
                                        </div>

                                      </div>

                                            {% endfor %}
                                </div>

                                          <div class='' style="text-align:left;word-wrap: break-word; word-break: normal;margin-bottom:40px;margin-left:100px;width:90%;margin-right:100px;">
                                            <button type="button" class="button" id='replybutton' style="border:none;background:white;margin-left:-8px;margin-top:-20px;color:grey" onclick="reply({{comment.id}})" style="">Reply</button>
                                          {% if roll < 0 %}
                                          <form method='post' name ='replyform' id='reply_form{{comment.id}}' action="{%url 'forum:save_comment' current.id 0 text_roll filt %}">
                                          {% else %}
                                            <form method='post' name ='replyform' id='reply_form{{comment.id}}' action="{%url 'forum:save_comment' current.id roll text_roll filt %}">
                                          {%endif%}
                                              {%csrf_token%}
                                                  <div id='reply_input{{comment.id}}' name='reply_div' style='display:none;margin-left:250px;margin-top:-90px;margin-bottom:100px;margin-right:100px;text-align:left'>
                                                    <p style='margin-bottom:5px' >Reply to <a name='colorauthor'>{{comment.author_name}}</a> :</p>
                                                    <textarea class="form-control" id="input_text{{comment.id}}" rows="3" autocomplete='off' spellcheck='false' placeholder="Your Reply goes here" name ="comment_text" required></textarea>
                                                      <input name = 'comment_id' value = {{comment.id}}  style='display:none'>
                                                    <div style='text-align:right'>
                                                        <button type="button" class="btn btn-primary btn-sm" id='commentbutton' style="align:right;margin-top:10px" onclick="cancelreply({{comment.id}})">Cancel</button>
                                                        <button type="button" class="btn btn-primary btn-sm" id='commentbutton' style="align:right;margin-top:10px" onclick="replysubmit({{comment.id}})">Post</button>
                                                        </div>
                                                  </div>
                                                </form>
                                          </div>





                                        
                            </div>
                      </div>
                      {%endfor%}
                    </div>

                    <div style='margin-bottom:100px;text-align:left;margin-top:20px;margin-right:100px;margin-left:100px'>
                      <button type="button" class="btn btn-primary btn-sm" id='commentbutton' style="" onclick="showcomment()">Add a Comment</button>
                    {%if roll < 0 %}
                    <form method='post' name ='commentform' id='comment_form' action="{%url 'forum:save_comment' current.id 0 text_roll filt %}">
                    {%else%}
                                <form method='post' name ='commentform' id='comment_form' action="{%url 'forum:save_comment' current.id roll text_roll filt %}">
                    {%endif%} 
                                  {%csrf_token%}
                                <div id='comment_input' style='display:none;margin-left:100px;margin-top:-90px;margin-bottom:100px;margin-right:100px;text-align:left'>
                                  <p style='color:#89cff0;margin-bottom:5px'>You :</p>
                                  <textarea class="form-control" id="commenttextarea" rows="3" autocomplete='off' spellcheck='false' placeholder="Your comment goes here" name ="comment_text" required></textarea>
                                      <input name = 'comment_id' value = -1  style='display:none'>
                                  <div style='text-align:right'>
                                      <button type="button" class="btn btn-primary btn-sm" id='commentbutton' style="align:right;margin-top:10px" onclick="cancelcomment()">Cancel</button>
                                      <button type="button" class="btn btn-primary btn-sm" id='commentbutton' style="align:right;margin-top:10px" onclick="commentsubmit()">Post</button>
                                      </div>
                                </div>
                              </form>
                            </div>
                            <script>
                              function changecolor(){
                                var x = document.getElementsByName('colorauthor');

                                for (var i = 0 ; i< x.length; i++){
                                  x[i].style.color=numberFromText(x[i].innerText);
                                }
                              }

                              function assigncolor(){
                                var x = document.getElementsByName('icon_svg');
                                for(var i =0; i<x.length;i++){
                                  var child = x[i].childNodes[2];
                                  var text = child.innerHTML;
                                  var color = numberFromText(text);
                                  x[i].childNodes[0].style='fill:'+color;
                                }
                              }

                            </script>
                    <script>
                      $("#maintext").scrollTop({{text_roll}});
                      window.onload=changecolor();
                      window.onload=assigncolor();
                    </script>
                    
              </div>
    </main>


  {% comment %} <footer class="mt-auto text-black-50" style="font-size:15px">
    <p>Supported by <a class="text-black">CS201 TA Team</a>. Contact Beilong Tang (<a class="text-black">bt132@duke.edu</a>) if you have problems.</p>
  </footer> {% endcomment %}
</div>


    
  </body>
</html>
